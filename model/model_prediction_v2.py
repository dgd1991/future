import gc
import time

import tensorflow as tf
import logging
import pandas as pd
import os
import json
from datetime import datetime
# from tensorflow.contrib import layers
# from tensorflow import feature_column
from tensorflow.python.training import queue_runner_impl
from tensorflow.core.util.event_pb2 import SessionLog
# os.environ['CUDA_VISIBLE_DEVICES'] = '0'
class DeepFM(object):
    def __init__(self, year, date, train_stype, model_name, saved_model):
        # for index in range(10):
        #     self.train_data.append('E:/pythonProject/future/data/datafile/sample/{model_name}/train_sample_{year}.csv'.format(
        #         model_name=model_name, year=str(index + 2008)))

        self.train_data = 'E:/pythonProject/future/data/datafile/sample/{model_name}/shuffled_train_sample_{year}.csv'.format(model_name=model_name, year=str(year))
        self.test_data = 'E:/pythonProject/future/data/datafile/prediction_sample/{model_name}/prediction_sample_{date}.csv'.format(model_name=model_name, date=str(date))
        self.prediction_result = 'E:/pythonProject/future/data/datafile/prediction_result/{model_name}/prediction_result_{date}.csv'.format(model_name=saved_model, date=str(date))
        self.task_type = train_stype
        self.checkpoint_path = "E:\\pythonProject\\future\\saved_model\\{model_name}".format(model_name=str(saved_model))
        self.save_summary_steps = 100000
        self.save_checkpoint_and_eval_step = 100000
        self.every_n_steps = 100000
        self.max_train_step = 5000000
        self.embedding_dim = 10
        # self.batch_size = 256
        self.batch_size = 256
        self.feature_columns_dict = {'other_feas': []}
        # self.lr = 0.000005
        self.lr = 0.0001
        self.optimizer = 'Adam'
        self.stddev = 0.1
        self.label_cnt = 12
        self.train_epoch = 1
        self.col_name = ['date', 'code', 'industry_name_level1', 'industry_name_level2', 'industry_name_level3', 'industry_id_level1', 'industry_id_level2', 'industry_id_level3', 'open_ratio', 'close_ratio', 'high_ratio', 'low_ratio', 'pctChg', 'code_market', 'open_ratio_7d_avg', 'close_ratio_7d_avg', 'high_ratio_7d_avg', 'low_ratio_7d_avg', 'amount', 'peTTM', 'pcfNcfTTM', 'pbMRQ', 'isST', 'turn', 'rsv_5', 'k_value_5', 'd_value_5', 'j_value_5', 'k_value_trend_5', 'kd_value5', 'rsv_9', 'k_value_9', 'd_value_9', 'j_value_9', 'k_value_trend_9', 'kd_value9', 'rsv_19', 'k_value_19', 'd_value_19', 'j_value_19', 'k_value_trend_19', 'kd_value19', 'rsv_73', 'k_value_73', 'd_value_73', 'j_value_73', 'k_value_trend_73', 'kd_value73', 'macd_positive', 'macd_dif_ratio', 'macd_dif_2', 'macd_dea_2', 'macd_2', 'macd_positive_ratio_2', 'macd_dif_3', 'macd_dea_3', 'macd_3', 'macd_positive_ratio_3', 'macd_dif_5', 'macd_dea_5', 'macd_5', 'macd_positive_ratio_5', 'macd_dif_10', 'macd_dea_10', 'macd_10', 'macd_positive_ratio_10', 'macd_dif_20', 'macd_dea_20', 'macd_20', 'macd_positive_ratio_20', 'macd_dif_40', 'macd_dea_40', 'macd_40', 'macd_positive_ratio_40', 'macd_dif_dea', 'width_20', 'close_mb20_diff', 'cr_3d', 'cr_5d', 'cr_10d', 'cr_20d', 'cr_40d', 'rsi_3d', 'rsi_5d', 'rsi_10d', 'rsi_20d', 'rsi_40d', 'turn_3d_avg', 'turn_3davg_dif', 'turn_3dmax_dif', 'turn_3dmin_dif', 'close_3davg_dif', 'close_3dmax_dif', 'close_3dmin_dif', 'close_3d_dif', 'turn_5d_avg', 'turn_5davg_dif', 'turn_5dmax_dif', 'turn_5dmin_dif', 'turn_3_5d_avg', 'close_5davg_dif', 'close_5dmax_dif', 'close_5dmin_dif', 'close_5d_dif', 'close_3_5d_avg', 'turn_10d_avg', 'turn_10davg_dif', 'turn_10dmax_dif', 'turn_10dmin_dif', 'turn_5_10d_avg', 'close_10davg_dif', 'close_10dmax_dif', 'close_10dmin_dif', 'close_10d_dif', 'close_5_10d_avg', 'turn_20d_avg', 'turn_20davg_dif', 'turn_20dmax_dif', 'turn_20dmin_dif', 'turn_10_20d_avg', 'close_20davg_dif', 'close_20dmax_dif', 'close_20dmin_dif', 'close_20d_dif', 'close_10_20d_avg', 'turn_30d_avg', 'turn_30davg_dif', 'turn_30dmax_dif', 'turn_30dmin_dif', 'turn_20_30d_avg', 'close_30davg_dif', 'close_30dmax_dif', 'close_30dmin_dif', 'close_30d_dif', 'close_20_30d_avg', 'turn_60d_avg', 'turn_60davg_dif', 'turn_60dmax_dif', 'turn_60dmin_dif', 'turn_30_60d_avg', 'close_60davg_dif', 'close_60dmax_dif', 'close_60dmin_dif', 'close_60d_dif', 'close_30_60d_avg', 'turn_120d_avg', 'turn_120davg_dif', 'turn_120dmax_dif', 'turn_120dmin_dif', 'turn_60_120d_avg', 'close_120davg_dif', 'close_120dmax_dif', 'close_120dmin_dif', 'close_120d_dif', 'close_60_120d_avg', 'turn_240d_avg', 'turn_240davg_dif', 'turn_240dmax_dif', 'turn_240dmin_dif', 'turn_120_240d_avg', 'close_240davg_dif', 'close_240dmax_dif', 'close_240dmin_dif', 'close_240d_dif', 'close_120_240d_avg', 'industry_id_level1_open', 'industry_id_level1_close', 'industry_id_level1_preclose', 'industry_id_level1_high', 'industry_id_level1_low', 'industry_id_level1_turn', 'industry_id_level1_amount', 'industry_id_level1_pctChg', 'industry_id_level1_peTTM', 'industry_id_level1_pcfNcfTTM', 'industry_id_level1_pbMRQ', 'industry_id_level1_rise_ratio', 'industry_id_level1_open_ratio', 'industry_id_level1_close_ratio', 'industry_id_level1_high_ratio', 'industry_id_level1_low_ratio', 'industry_id_level1_open_ratio_7d_avg', 'industry_id_level1_close_ratio_7d_avg', 'industry_id_level1_high_ratio_7d_avg', 'industry_id_level1_low_ratio_7d_avg', 'industry_id_level1_rsv_5', 'industry_id_level1_k_value_5', 'industry_id_level1_d_value_5', 'industry_id_level1_j_value_5', 'industry_id_level1_k_value_trend_5', 'industry_id_level1_kd_value5', 'industry_id_level1_rsv_9', 'industry_id_level1_k_value_9', 'industry_id_level1_d_value_9', 'industry_id_level1_j_value_9', 'industry_id_level1_k_value_trend_9', 'industry_id_level1_kd_value9', 'industry_id_level1_rsv_19', 'industry_id_level1_k_value_19', 'industry_id_level1_d_value_19', 'industry_id_level1_j_value_19', 'industry_id_level1_k_value_trend_19', 'industry_id_level1_kd_value19', 'industry_id_level1_rsv_73', 'industry_id_level1_k_value_73', 'industry_id_level1_d_value_73', 'industry_id_level1_j_value_73', 'industry_id_level1_k_value_trend_73', 'industry_id_level1_kd_value73', 'industry_id_level1_macd_positive', 'industry_id_level1_macd_dif_ratio', 'industry_id_level1_macd_dif_2', 'industry_id_level1_macd_dea_2', 'industry_id_level1_macd_2', 'industry_id_level1_macd_positive_ratio_2', 'industry_id_level1_macd_dif_3', 'industry_id_level1_macd_dea_3', 'industry_id_level1_macd_3', 'industry_id_level1_macd_positive_ratio_3', 'industry_id_level1_macd_dif_5', 'industry_id_level1_macd_dea_5', 'industry_id_level1_macd_5', 'industry_id_level1_macd_positive_ratio_5', 'industry_id_level1_macd_dif_10', 'industry_id_level1_macd_dea_10', 'industry_id_level1_macd_10', 'industry_id_level1_macd_positive_ratio_10', 'industry_id_level1_macd_dif_20', 'industry_id_level1_macd_dea_20', 'industry_id_level1_macd_20', 'industry_id_level1_macd_positive_ratio_20', 'industry_id_level1_macd_dif_40', 'industry_id_level1_macd_dea_40', 'industry_id_level1_macd_40', 'industry_id_level1_macd_positive_ratio_40', 'industry_id_level1_macd_dif_dea', 'industry_id_level1_width_20', 'industry_id_level1_close_mb20_diff', 'industry_id_level1_cr_3d', 'industry_id_level1_cr_5d', 'industry_id_level1_cr_10d', 'industry_id_level1_cr_20d', 'industry_id_level1_cr_40d', 'industry_id_level1_rsi_3d', 'industry_id_level1_rsi_5d', 'industry_id_level1_rsi_10d', 'industry_id_level1_rsi_20d', 'industry_id_level1_rsi_40d', 'industry_id_level1_turn_3d_avg', 'industry_id_level1_turn_3davg_dif', 'industry_id_level1_turn_3dmax_dif', 'industry_id_level1_turn_3dmin_dif', 'industry_id_level1_close_3davg_dif', 'industry_id_level1_close_3dmax_dif', 'industry_id_level1_close_3dmin_dif', 'industry_id_level1_close_3d_dif', 'industry_id_level1_turn_5d_avg', 'industry_id_level1_turn_5davg_dif', 'industry_id_level1_turn_5dmax_dif', 'industry_id_level1_turn_5dmin_dif', 'industry_id_level1_turn_3_5d_avg', 'industry_id_level1_close_5davg_dif', 'industry_id_level1_close_5dmax_dif', 'industry_id_level1_close_5dmin_dif', 'industry_id_level1_close_5d_dif', 'industry_id_level1_close_3_5d_avg', 'industry_id_level1_turn_10d_avg', 'industry_id_level1_turn_10davg_dif', 'industry_id_level1_turn_10dmax_dif', 'industry_id_level1_turn_10dmin_dif', 'industry_id_level1_turn_5_10d_avg', 'industry_id_level1_close_10davg_dif', 'industry_id_level1_close_10dmax_dif', 'industry_id_level1_close_10dmin_dif', 'industry_id_level1_close_10d_dif', 'industry_id_level1_close_5_10d_avg', 'industry_id_level1_turn_20d_avg', 'industry_id_level1_turn_20davg_dif', 'industry_id_level1_turn_20dmax_dif', 'industry_id_level1_turn_20dmin_dif', 'industry_id_level1_turn_10_20d_avg', 'industry_id_level1_close_20davg_dif', 'industry_id_level1_close_20dmax_dif', 'industry_id_level1_close_20dmin_dif', 'industry_id_level1_close_20d_dif', 'industry_id_level1_close_10_20d_avg', 'industry_id_level1_turn_30d_avg', 'industry_id_level1_turn_30davg_dif', 'industry_id_level1_turn_30dmax_dif', 'industry_id_level1_turn_30dmin_dif', 'industry_id_level1_turn_20_30d_avg', 'industry_id_level1_close_30davg_dif', 'industry_id_level1_close_30dmax_dif', 'industry_id_level1_close_30dmin_dif', 'industry_id_level1_close_30d_dif', 'industry_id_level1_close_20_30d_avg', 'industry_id_level1_turn_60d_avg', 'industry_id_level1_turn_60davg_dif', 'industry_id_level1_turn_60dmax_dif', 'industry_id_level1_turn_60dmin_dif', 'industry_id_level1_turn_30_60d_avg', 'industry_id_level1_close_60davg_dif', 'industry_id_level1_close_60dmax_dif', 'industry_id_level1_close_60dmin_dif', 'industry_id_level1_close_60d_dif', 'industry_id_level1_close_30_60d_avg', 'industry_id_level1_turn_120d_avg', 'industry_id_level1_turn_120davg_dif', 'industry_id_level1_turn_120dmax_dif', 'industry_id_level1_turn_120dmin_dif', 'industry_id_level1_turn_60_120d_avg', 'industry_id_level1_close_120davg_dif', 'industry_id_level1_close_120dmax_dif', 'industry_id_level1_close_120dmin_dif', 'industry_id_level1_close_120d_dif', 'industry_id_level1_close_60_120d_avg', 'industry_id_level1_turn_240d_avg', 'industry_id_level1_turn_240davg_dif', 'industry_id_level1_turn_240dmax_dif', 'industry_id_level1_turn_240dmin_dif', 'industry_id_level1_turn_120_240d_avg', 'industry_id_level1_close_240davg_dif', 'industry_id_level1_close_240dmax_dif', 'industry_id_level1_close_240dmin_dif', 'industry_id_level1_close_240d_dif', 'industry_id_level1_close_120_240d_avg', 'industry_id_level2_open', 'industry_id_level2_close', 'industry_id_level2_preclose', 'industry_id_level2_high', 'industry_id_level2_low', 'industry_id_level2_turn', 'industry_id_level2_amount', 'industry_id_level2_pctChg', 'industry_id_level2_peTTM', 'industry_id_level2_pcfNcfTTM', 'industry_id_level2_pbMRQ', 'industry_id_level2_rise_ratio', 'industry_id_level2_open_ratio', 'industry_id_level2_close_ratio', 'industry_id_level2_high_ratio', 'industry_id_level2_low_ratio', 'industry_id_level2_open_ratio_7d_avg', 'industry_id_level2_close_ratio_7d_avg', 'industry_id_level2_high_ratio_7d_avg', 'industry_id_level2_low_ratio_7d_avg', 'industry_id_level2_rsv_5', 'industry_id_level2_k_value_5', 'industry_id_level2_d_value_5', 'industry_id_level2_j_value_5', 'industry_id_level2_k_value_trend_5', 'industry_id_level2_kd_value5', 'industry_id_level2_rsv_9', 'industry_id_level2_k_value_9', 'industry_id_level2_d_value_9', 'industry_id_level2_j_value_9', 'industry_id_level2_k_value_trend_9', 'industry_id_level2_kd_value9', 'industry_id_level2_rsv_19', 'industry_id_level2_k_value_19', 'industry_id_level2_d_value_19', 'industry_id_level2_j_value_19', 'industry_id_level2_k_value_trend_19', 'industry_id_level2_kd_value19', 'industry_id_level2_rsv_73', 'industry_id_level2_k_value_73', 'industry_id_level2_d_value_73', 'industry_id_level2_j_value_73', 'industry_id_level2_k_value_trend_73', 'industry_id_level2_kd_value73', 'industry_id_level2_macd_positive', 'industry_id_level2_macd_dif_ratio', 'industry_id_level2_macd_dif_2', 'industry_id_level2_macd_dea_2', 'industry_id_level2_macd_2', 'industry_id_level2_macd_positive_ratio_2', 'industry_id_level2_macd_dif_3', 'industry_id_level2_macd_dea_3', 'industry_id_level2_macd_3', 'industry_id_level2_macd_positive_ratio_3', 'industry_id_level2_macd_dif_5', 'industry_id_level2_macd_dea_5', 'industry_id_level2_macd_5', 'industry_id_level2_macd_positive_ratio_5', 'industry_id_level2_macd_dif_10', 'industry_id_level2_macd_dea_10', 'industry_id_level2_macd_10', 'industry_id_level2_macd_positive_ratio_10', 'industry_id_level2_macd_dif_20', 'industry_id_level2_macd_dea_20', 'industry_id_level2_macd_20', 'industry_id_level2_macd_positive_ratio_20', 'industry_id_level2_macd_dif_40', 'industry_id_level2_macd_dea_40', 'industry_id_level2_macd_40', 'industry_id_level2_macd_positive_ratio_40', 'industry_id_level2_macd_dif_dea', 'industry_id_level2_width_20', 'industry_id_level2_close_mb20_diff', 'industry_id_level2_cr_3d', 'industry_id_level2_cr_5d', 'industry_id_level2_cr_10d', 'industry_id_level2_cr_20d', 'industry_id_level2_cr_40d', 'industry_id_level2_rsi_3d', 'industry_id_level2_rsi_5d', 'industry_id_level2_rsi_10d', 'industry_id_level2_rsi_20d', 'industry_id_level2_rsi_40d', 'industry_id_level2_turn_3d_avg', 'industry_id_level2_turn_3davg_dif', 'industry_id_level2_turn_3dmax_dif', 'industry_id_level2_turn_3dmin_dif', 'industry_id_level2_close_3davg_dif', 'industry_id_level2_close_3dmax_dif', 'industry_id_level2_close_3dmin_dif', 'industry_id_level2_close_3d_dif', 'industry_id_level2_turn_5d_avg', 'industry_id_level2_turn_5davg_dif', 'industry_id_level2_turn_5dmax_dif', 'industry_id_level2_turn_5dmin_dif', 'industry_id_level2_turn_3_5d_avg', 'industry_id_level2_close_5davg_dif', 'industry_id_level2_close_5dmax_dif', 'industry_id_level2_close_5dmin_dif', 'industry_id_level2_close_5d_dif', 'industry_id_level2_close_3_5d_avg', 'industry_id_level2_turn_10d_avg', 'industry_id_level2_turn_10davg_dif', 'industry_id_level2_turn_10dmax_dif', 'industry_id_level2_turn_10dmin_dif', 'industry_id_level2_turn_5_10d_avg', 'industry_id_level2_close_10davg_dif', 'industry_id_level2_close_10dmax_dif', 'industry_id_level2_close_10dmin_dif', 'industry_id_level2_close_10d_dif', 'industry_id_level2_close_5_10d_avg', 'industry_id_level2_turn_20d_avg', 'industry_id_level2_turn_20davg_dif', 'industry_id_level2_turn_20dmax_dif', 'industry_id_level2_turn_20dmin_dif', 'industry_id_level2_turn_10_20d_avg', 'industry_id_level2_close_20davg_dif', 'industry_id_level2_close_20dmax_dif', 'industry_id_level2_close_20dmin_dif', 'industry_id_level2_close_20d_dif', 'industry_id_level2_close_10_20d_avg', 'industry_id_level2_turn_30d_avg', 'industry_id_level2_turn_30davg_dif', 'industry_id_level2_turn_30dmax_dif', 'industry_id_level2_turn_30dmin_dif', 'industry_id_level2_turn_20_30d_avg', 'industry_id_level2_close_30davg_dif', 'industry_id_level2_close_30dmax_dif', 'industry_id_level2_close_30dmin_dif', 'industry_id_level2_close_30d_dif', 'industry_id_level2_close_20_30d_avg', 'industry_id_level2_turn_60d_avg', 'industry_id_level2_turn_60davg_dif', 'industry_id_level2_turn_60dmax_dif', 'industry_id_level2_turn_60dmin_dif', 'industry_id_level2_turn_30_60d_avg', 'industry_id_level2_close_60davg_dif', 'industry_id_level2_close_60dmax_dif', 'industry_id_level2_close_60dmin_dif', 'industry_id_level2_close_60d_dif', 'industry_id_level2_close_30_60d_avg', 'industry_id_level2_turn_120d_avg', 'industry_id_level2_turn_120davg_dif', 'industry_id_level2_turn_120dmax_dif', 'industry_id_level2_turn_120dmin_dif', 'industry_id_level2_turn_60_120d_avg', 'industry_id_level2_close_120davg_dif', 'industry_id_level2_close_120dmax_dif', 'industry_id_level2_close_120dmin_dif', 'industry_id_level2_close_120d_dif', 'industry_id_level2_close_60_120d_avg', 'industry_id_level2_turn_240d_avg', 'industry_id_level2_turn_240davg_dif', 'industry_id_level2_turn_240dmax_dif', 'industry_id_level2_turn_240dmin_dif', 'industry_id_level2_turn_120_240d_avg', 'industry_id_level2_close_240davg_dif', 'industry_id_level2_close_240dmax_dif', 'industry_id_level2_close_240dmin_dif', 'industry_id_level2_close_240d_dif', 'industry_id_level2_close_120_240d_avg', 'industry_id_level3_open', 'industry_id_level3_close', 'industry_id_level3_preclose', 'industry_id_level3_high', 'industry_id_level3_low', 'industry_id_level3_turn', 'industry_id_level3_amount', 'industry_id_level3_pctChg', 'industry_id_level3_peTTM', 'industry_id_level3_pcfNcfTTM', 'industry_id_level3_pbMRQ', 'industry_id_level3_rise_ratio', 'industry_id_level3_open_ratio', 'industry_id_level3_close_ratio', 'industry_id_level3_high_ratio', 'industry_id_level3_low_ratio', 'industry_id_level3_open_ratio_7d_avg', 'industry_id_level3_close_ratio_7d_avg', 'industry_id_level3_high_ratio_7d_avg', 'industry_id_level3_low_ratio_7d_avg', 'industry_id_level3_rsv_5', 'industry_id_level3_k_value_5', 'industry_id_level3_d_value_5', 'industry_id_level3_j_value_5', 'industry_id_level3_k_value_trend_5', 'industry_id_level3_kd_value5', 'industry_id_level3_rsv_9', 'industry_id_level3_k_value_9', 'industry_id_level3_d_value_9', 'industry_id_level3_j_value_9', 'industry_id_level3_k_value_trend_9', 'industry_id_level3_kd_value9', 'industry_id_level3_rsv_19', 'industry_id_level3_k_value_19', 'industry_id_level3_d_value_19', 'industry_id_level3_j_value_19', 'industry_id_level3_k_value_trend_19', 'industry_id_level3_kd_value19', 'industry_id_level3_rsv_73', 'industry_id_level3_k_value_73', 'industry_id_level3_d_value_73', 'industry_id_level3_j_value_73', 'industry_id_level3_k_value_trend_73', 'industry_id_level3_kd_value73', 'industry_id_level3_macd_positive', 'industry_id_level3_macd_dif_ratio', 'industry_id_level3_macd_dif_2', 'industry_id_level3_macd_dea_2', 'industry_id_level3_macd_2', 'industry_id_level3_macd_positive_ratio_2', 'industry_id_level3_macd_dif_3', 'industry_id_level3_macd_dea_3', 'industry_id_level3_macd_3', 'industry_id_level3_macd_positive_ratio_3', 'industry_id_level3_macd_dif_5', 'industry_id_level3_macd_dea_5', 'industry_id_level3_macd_5', 'industry_id_level3_macd_positive_ratio_5', 'industry_id_level3_macd_dif_10', 'industry_id_level3_macd_dea_10', 'industry_id_level3_macd_10', 'industry_id_level3_macd_positive_ratio_10', 'industry_id_level3_macd_dif_20', 'industry_id_level3_macd_dea_20', 'industry_id_level3_macd_20', 'industry_id_level3_macd_positive_ratio_20', 'industry_id_level3_macd_dif_40', 'industry_id_level3_macd_dea_40', 'industry_id_level3_macd_40', 'industry_id_level3_macd_positive_ratio_40', 'industry_id_level3_macd_dif_dea', 'industry_id_level3_width_20', 'industry_id_level3_close_mb20_diff', 'industry_id_level3_cr_3d', 'industry_id_level3_cr_5d', 'industry_id_level3_cr_10d', 'industry_id_level3_cr_20d', 'industry_id_level3_cr_40d', 'industry_id_level3_rsi_3d', 'industry_id_level3_rsi_5d', 'industry_id_level3_rsi_10d', 'industry_id_level3_rsi_20d', 'industry_id_level3_rsi_40d', 'industry_id_level3_turn_3d_avg', 'industry_id_level3_turn_3davg_dif', 'industry_id_level3_turn_3dmax_dif', 'industry_id_level3_turn_3dmin_dif', 'industry_id_level3_close_3davg_dif', 'industry_id_level3_close_3dmax_dif', 'industry_id_level3_close_3dmin_dif', 'industry_id_level3_close_3d_dif', 'industry_id_level3_turn_5d_avg', 'industry_id_level3_turn_5davg_dif', 'industry_id_level3_turn_5dmax_dif', 'industry_id_level3_turn_5dmin_dif', 'industry_id_level3_turn_3_5d_avg', 'industry_id_level3_close_5davg_dif', 'industry_id_level3_close_5dmax_dif', 'industry_id_level3_close_5dmin_dif', 'industry_id_level3_close_5d_dif', 'industry_id_level3_close_3_5d_avg', 'industry_id_level3_turn_10d_avg', 'industry_id_level3_turn_10davg_dif', 'industry_id_level3_turn_10dmax_dif', 'industry_id_level3_turn_10dmin_dif', 'industry_id_level3_turn_5_10d_avg', 'industry_id_level3_close_10davg_dif', 'industry_id_level3_close_10dmax_dif', 'industry_id_level3_close_10dmin_dif', 'industry_id_level3_close_10d_dif', 'industry_id_level3_close_5_10d_avg', 'industry_id_level3_turn_20d_avg', 'industry_id_level3_turn_20davg_dif', 'industry_id_level3_turn_20dmax_dif', 'industry_id_level3_turn_20dmin_dif', 'industry_id_level3_turn_10_20d_avg', 'industry_id_level3_close_20davg_dif', 'industry_id_level3_close_20dmax_dif', 'industry_id_level3_close_20dmin_dif', 'industry_id_level3_close_20d_dif', 'industry_id_level3_close_10_20d_avg', 'industry_id_level3_turn_30d_avg', 'industry_id_level3_turn_30davg_dif', 'industry_id_level3_turn_30dmax_dif', 'industry_id_level3_turn_30dmin_dif', 'industry_id_level3_turn_20_30d_avg', 'industry_id_level3_close_30davg_dif', 'industry_id_level3_close_30dmax_dif', 'industry_id_level3_close_30dmin_dif', 'industry_id_level3_close_30d_dif', 'industry_id_level3_close_20_30d_avg', 'industry_id_level3_turn_60d_avg', 'industry_id_level3_turn_60davg_dif', 'industry_id_level3_turn_60dmax_dif', 'industry_id_level3_turn_60dmin_dif', 'industry_id_level3_turn_30_60d_avg', 'industry_id_level3_close_60davg_dif', 'industry_id_level3_close_60dmax_dif', 'industry_id_level3_close_60dmin_dif', 'industry_id_level3_close_60d_dif', 'industry_id_level3_close_30_60d_avg', 'industry_id_level3_turn_120d_avg', 'industry_id_level3_turn_120davg_dif', 'industry_id_level3_turn_120dmax_dif', 'industry_id_level3_turn_120dmin_dif', 'industry_id_level3_turn_60_120d_avg', 'industry_id_level3_close_120davg_dif', 'industry_id_level3_close_120dmax_dif', 'industry_id_level3_close_120dmin_dif', 'industry_id_level3_close_120d_dif', 'industry_id_level3_close_60_120d_avg', 'industry_id_level3_turn_240d_avg', 'industry_id_level3_turn_240davg_dif', 'industry_id_level3_turn_240dmax_dif', 'industry_id_level3_turn_240dmin_dif', 'industry_id_level3_turn_120_240d_avg', 'industry_id_level3_close_240davg_dif', 'industry_id_level3_close_240dmax_dif', 'industry_id_level3_close_240dmin_dif', 'industry_id_level3_close_240d_dif', 'industry_id_level3_close_120_240d_avg', 'all_pctChg', 'all_turn', 'all_rise_ratio', 'all_pctChg_3', 'all_turn_3', 'all_rise_ratio_3', 'all_pctChg_5', 'all_turn_5', 'all_rise_ratio_5', 'all_pctChg_10', 'all_turn_10', 'all_rise_ratio_10', 'zs_open_ratio', 'zs_close_ratio', 'zs_high_ratio', 'zs_low_ratio', 'zs_pctChg', 'zs_open_ratio_7d_avg', 'zs_close_ratio_7d_avg', 'zs_high_ratio_7d_avg', 'zs_low_ratio_7d_avg', 'zs_amount', 'zs_turn', 'zs_rsv_5', 'zs_k_value_5', 'zs_d_value_5', 'zs_j_value_5', 'zs_k_value_trend_5', 'zs_kd_value5', 'zs_rsv_9', 'zs_k_value_9', 'zs_d_value_9', 'zs_j_value_9', 'zs_k_value_trend_9', 'zs_kd_value9', 'zs_rsv_19', 'zs_k_value_19', 'zs_d_value_19', 'zs_j_value_19', 'zs_k_value_trend_19', 'zs_kd_value19', 'zs_rsv_73', 'zs_k_value_73', 'zs_d_value_73', 'zs_j_value_73', 'zs_k_value_trend_73', 'zs_kd_value73', 'zs_macd_positive', 'zs_macd_dif_ratio', 'zs_macd_dif_2', 'zs_macd_dea_2', 'zs_macd_2', 'zs_macd_positive_ratio_2', 'zs_macd_dif_3', 'zs_macd_dea_3', 'zs_macd_3', 'zs_macd_positive_ratio_3', 'zs_macd_dif_5', 'zs_macd_dea_5', 'zs_macd_5', 'zs_macd_positive_ratio_5', 'zs_macd_dif_10', 'zs_macd_dea_10', 'zs_macd_10', 'zs_macd_positive_ratio_10', 'zs_macd_dif_20', 'zs_macd_dea_20', 'zs_macd_20', 'zs_macd_positive_ratio_20', 'zs_macd_dif_40', 'zs_macd_dea_40', 'zs_macd_40', 'zs_macd_positive_ratio_40', 'zs_macd_dif_dea', 'zs_width_20', 'zs_close_mb20_diff', 'zs_cr_3d', 'zs_cr_5d', 'zs_cr_10d', 'zs_cr_20d', 'zs_cr_40d', 'zs_rsi_3d', 'zs_rsi_5d', 'zs_rsi_10d', 'zs_rsi_20d', 'zs_rsi_40d', 'zs_turn_3d_avg', 'zs_turn_3davg_dif', 'zs_turn_3dmax_dif', 'zs_turn_3dmin_dif', 'zs_close_3davg_dif', 'zs_close_3dmax_dif', 'zs_close_3dmin_dif', 'zs_close_3d_dif', 'zs_turn_5d_avg', 'zs_turn_5davg_dif', 'zs_turn_5dmax_dif', 'zs_turn_5dmin_dif', 'zs_turn_3_5d_avg', 'zs_close_5davg_dif', 'zs_close_5dmax_dif', 'zs_close_5dmin_dif', 'zs_close_5d_dif', 'zs_close_3_5d_avg', 'zs_turn_10d_avg', 'zs_turn_10davg_dif', 'zs_turn_10dmax_dif', 'zs_turn_10dmin_dif', 'zs_turn_5_10d_avg', 'zs_close_10davg_dif', 'zs_close_10dmax_dif', 'zs_close_10dmin_dif', 'zs_close_10d_dif', 'zs_close_5_10d_avg', 'zs_turn_20d_avg', 'zs_turn_20davg_dif', 'zs_turn_20dmax_dif', 'zs_turn_20dmin_dif', 'zs_turn_10_20d_avg', 'zs_close_20davg_dif', 'zs_close_20dmax_dif', 'zs_close_20dmin_dif', 'zs_close_20d_dif', 'zs_close_10_20d_avg', 'zs_turn_30d_avg', 'zs_turn_30davg_dif', 'zs_turn_30dmax_dif', 'zs_turn_30dmin_dif', 'zs_turn_20_30d_avg', 'zs_close_30davg_dif', 'zs_close_30dmax_dif', 'zs_close_30dmin_dif', 'zs_close_30d_dif', 'zs_close_20_30d_avg', 'zs_turn_60d_avg', 'zs_turn_60davg_dif', 'zs_turn_60dmax_dif', 'zs_turn_60dmin_dif', 'zs_turn_30_60d_avg', 'zs_close_60davg_dif', 'zs_close_60dmax_dif', 'zs_close_60dmin_dif', 'zs_close_60d_dif', 'zs_close_30_60d_avg', 'zs_turn_120d_avg', 'zs_turn_120davg_dif', 'zs_turn_120dmax_dif', 'zs_turn_120dmin_dif', 'zs_turn_60_120d_avg', 'zs_close_120davg_dif', 'zs_close_120dmax_dif', 'zs_close_120dmin_dif', 'zs_close_120d_dif', 'zs_close_60_120d_avg', 'zs_turn_240d_avg', 'zs_turn_240davg_dif', 'zs_turn_240dmax_dif', 'zs_turn_240dmin_dif', 'zs_turn_120_240d_avg', 'zs_close_240davg_dif', 'zs_close_240dmax_dif', 'zs_close_240dmin_dif', 'zs_close_240d_dif', 'zs_close_120_240d_avg', 'label_7', 'label_7_real', 'label_7_weight', 'label_7_max', 'label_7_max_real', 'label_7_max_weight', 'label_15', 'label_15_real', 'label_15_weight', 'label_15_max', 'label_15_max_real', 'label_15_max_weight']
        self.select_col = [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        self.record_defaults = [[0], ['mydefault'], ['mydefault'], ['mydefault'], ['mydefault'], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [1.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [1.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [1.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0], [0.0]]
        self.fea_config = {'date': {'bucket': 10, 'dim': 5, 'type': 'bigint'}, 'code': {'bucket': 100010, 'dim': 20, 'type': 'string'}, 'industry_name_level1': {'bucket': 110, 'dim': 5, 'type': 'string'}, 'industry_name_level2': {'bucket': 110, 'dim': 5, 'type': 'string'}, 'industry_name_level3': {'bucket': 110, 'dim': 5, 'type': 'string'}, 'industry_id_level1': {'bucket': 210, 'dim': 5, 'type': 'bucketId'}, 'industry_id_level2': {'bucket': 510, 'dim': 5, 'type': 'bucketId'}, 'industry_id_level3': {'bucket': 1010, 'dim': 5, 'type': 'bucketId'}, 'open_ratio': {'bucket': 10, 'dim': 0, 'type': 'float'}, 'close_ratio': {'bucket': 10, 'dim': 0, 'type': 'float'}, 'high_ratio': {'bucket': 10, 'dim': 0, 'type': 'float'}, 'low_ratio': {'bucket': 10, 'dim': 0, 'type': 'float'}, 'pctChg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'code_market': {'bucket': 20, 'dim': 2, 'type': 'bucketId'}, 'open_ratio_7d_avg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'close_ratio_7d_avg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'high_ratio_7d_avg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'low_ratio_7d_avg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'amount': {'bucket': 10010, 'dim': 10, 'type': 'float2bucket'}, 'peTTM': {'bucket': 1510, 'dim': 6, 'type': 'float2bucket'}, 'pcfNcfTTM': {'bucket': 2010, 'dim': 6, 'type': 'float2bucket'}, 'pbMRQ': {'bucket': 2010, 'dim': 6, 'type': 'float2bucket'}, 'isST': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'turn': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'rsv_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'k_value_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'd_value_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'j_value_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'k_value_trend_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'kd_value5': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'rsv_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'k_value_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'd_value_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'j_value_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'k_value_trend_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'kd_value9': {'bucket': 210, 'dim': 5, 'type': 'bucketId'}, 'rsv_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'k_value_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'd_value_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'j_value_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'k_value_trend_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'kd_value19': {'bucket': 210, 'dim': 5, 'type': 'bucketId'}, 'rsv_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'k_value_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'd_value_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'j_value_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'k_value_trend_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'kd_value73': {'bucket': 210, 'dim': 5, 'type': 'bucketId'}, 'macd_positive': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_dif_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'macd_dif_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_dea_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_positive_ratio_2': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'macd_dif_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_dea_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_positive_ratio_3': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'macd_dif_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_dea_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_positive_ratio_5': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'macd_dif_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_dea_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_positive_ratio_10': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'macd_dif_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_dea_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_positive_ratio_20': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'macd_dif_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_dea_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'macd_positive_ratio_40': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'macd_dif_dea': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'width_20': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'close_mb20_diff': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'cr_3d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'cr_5d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'cr_10d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'cr_20d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'cr_40d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'rsi_3d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'rsi_5d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'rsi_10d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'rsi_20d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'rsi_40d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'turn_3d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_3dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_3dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'close_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_3d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_5dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'close_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_5dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'close_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_5d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_10dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'close_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_10dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'close_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_10d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_20dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'close_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_20dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'close_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_20d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_30dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'close_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_30dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'close_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_30d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_60dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'close_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_60dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'close_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_60d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_120dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'close_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_120dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'close_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_120d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'turn_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_240dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'turn_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'close_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_240dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'close_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_240d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'close_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_open': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_preclose': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_high': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_low': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_amount': {'bucket': 10010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_pctChg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'industry_id_level1_peTTM': {'bucket': 1510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_pcfNcfTTM': {'bucket': 2010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_pbMRQ': {'bucket': 2010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_rise_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_open_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_close_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_high_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_low_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_open_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_close_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_high_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_low_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_rsv_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_k_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_d_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_j_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_k_value_trend_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_kd_value5': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_rsv_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_k_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_d_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_j_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_k_value_trend_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_kd_value9': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_rsv_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_k_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_d_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_j_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_k_value_trend_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_kd_value19': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_rsv_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_k_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_d_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_j_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_k_value_trend_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_kd_value73': {'bucket': 13, 'dim': 5, 'type': 'bucketId'}, 'industry_id_level1_macd_positive': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_dif_ratio': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'industry_id_level1_macd_dif_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_dea_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_positive_ratio_2': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_macd_dif_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_dea_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_positive_ratio_3': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_macd_dif_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_dea_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_positive_ratio_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_macd_dif_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_dea_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_positive_ratio_10': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'industry_id_level1_macd_dif_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_dea_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_positive_ratio_20': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_macd_dif_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_dea_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_macd_positive_ratio_40': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_macd_dif_dea': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level1_width_20': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_close_mb20_diff': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_cr_3d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_cr_5d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_cr_10d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_cr_20d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_cr_40d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_rsi_3d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_rsi_5d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_rsi_10d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_rsi_20d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_rsi_40d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level1_turn_3d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_3dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_3dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_3d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_5dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_5dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_5d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_10dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_10dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_10d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_20dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_20dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_20d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_30dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_30dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_30d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_60dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_60dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_60d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_120dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_120dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_120d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_240dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_turn_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_240dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_240d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level1_close_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_open': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_preclose': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_high': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_low': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_amount': {'bucket': 10010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_pctChg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'industry_id_level2_peTTM': {'bucket': 1510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_pcfNcfTTM': {'bucket': 2010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_pbMRQ': {'bucket': 2010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_rise_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_open_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_close_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_high_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_low_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_open_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_close_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_high_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_low_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_rsv_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_k_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_d_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_j_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_k_value_trend_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_kd_value5': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_rsv_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_k_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_d_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_j_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_k_value_trend_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_kd_value9': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_rsv_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_k_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_d_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_j_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_k_value_trend_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_kd_value19': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_rsv_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_k_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_d_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_j_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_k_value_trend_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_kd_value73': {'bucket': 13, 'dim': 5, 'type': 'bucketId'}, 'industry_id_level2_macd_positive': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_dif_ratio': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'industry_id_level2_macd_dif_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_dea_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_positive_ratio_2': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_macd_dif_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_dea_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_positive_ratio_3': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_macd_dif_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_dea_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_positive_ratio_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_macd_dif_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_dea_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_positive_ratio_10': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'industry_id_level2_macd_dif_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_dea_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_positive_ratio_20': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_macd_dif_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_dea_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_macd_positive_ratio_40': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_macd_dif_dea': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level2_width_20': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_close_mb20_diff': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_cr_3d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_cr_5d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_cr_10d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_cr_20d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_cr_40d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_rsi_3d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_rsi_5d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_rsi_10d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_rsi_20d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_rsi_40d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level2_turn_3d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_3dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_3dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_3d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_5dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_5dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_5d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_10dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_10dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_10d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_20dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_20dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_20d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_30dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_30dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_30d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_60dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_60dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_60d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_120dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_120dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_120d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_240dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_turn_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_240dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_240d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level2_close_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_open': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_preclose': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_high': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_low': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_amount': {'bucket': 10010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_pctChg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'industry_id_level3_peTTM': {'bucket': 1510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_pcfNcfTTM': {'bucket': 2010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_pbMRQ': {'bucket': 2010, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_rise_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_open_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_close_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_high_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_low_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_open_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_close_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_high_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_low_ratio_7d_avg': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_rsv_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_k_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_d_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_j_value_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_k_value_trend_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_kd_value5': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_rsv_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_k_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_d_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_j_value_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_k_value_trend_9': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_kd_value9': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_rsv_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_k_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_d_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_j_value_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_k_value_trend_19': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_kd_value19': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_rsv_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_k_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_d_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_j_value_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_k_value_trend_73': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_kd_value73': {'bucket': 13, 'dim': 5, 'type': 'bucketId'}, 'industry_id_level3_macd_positive': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_dif_ratio': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'industry_id_level3_macd_dif_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_dea_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_positive_ratio_2': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_macd_dif_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_dea_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_positive_ratio_3': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_macd_dif_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_dea_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_positive_ratio_5': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_macd_dif_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_dea_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_positive_ratio_10': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'industry_id_level3_macd_dif_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_dea_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_positive_ratio_20': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_macd_dif_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_dea_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_macd_positive_ratio_40': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_macd_dif_dea': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'industry_id_level3_width_20': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_close_mb20_diff': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_cr_3d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_cr_5d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_cr_10d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_cr_20d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_cr_40d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_rsi_3d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_rsi_5d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_rsi_10d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_rsi_20d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_rsi_40d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'industry_id_level3_turn_3d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_3dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_3dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_3d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_5dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_5dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_5d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_10dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_10dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_10d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_20dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_20dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_20d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_30dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_30dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_30d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_60dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_60dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_60d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_120dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_120dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_120d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_240dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_turn_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_240dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_240d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'industry_id_level3_close_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'all_pctChg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'all_turn': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'all_rise_ratio': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'all_pctChg_3': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'all_turn_3': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'all_rise_ratio_3': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'all_pctChg_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'all_turn_5': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'all_rise_ratio_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'all_pctChg_10': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'all_turn_10': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'all_rise_ratio_10': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_open_ratio': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_close_ratio': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_high_ratio': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_low_ratio': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_pctChg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_open_ratio_7d_avg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_close_ratio_7d_avg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_high_ratio_7d_avg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_low_ratio_7d_avg': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_amount': {'bucket': 10010, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_rsv_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_k_value_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_d_value_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_j_value_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_k_value_trend_5': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_kd_value5': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'zs_rsv_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_k_value_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_d_value_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_j_value_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_k_value_trend_9': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_kd_value9': {'bucket': 210, 'dim': 5, 'type': 'bucketId'}, 'zs_rsv_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_k_value_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_d_value_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_j_value_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_k_value_trend_19': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_kd_value19': {'bucket': 210, 'dim': 5, 'type': 'bucketId'}, 'zs_rsv_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_k_value_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_d_value_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_j_value_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_k_value_trend_73': {'bucket': 210, 'dim': 5, 'type': 'float'}, 'zs_kd_value73': {'bucket': 210, 'dim': 5, 'type': 'bucketId'}, 'zs_macd_positive': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_dif_ratio': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'zs_macd_dif_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_dea_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_2': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_positive_ratio_2': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'zs_macd_dif_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_dea_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_3': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_positive_ratio_3': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'zs_macd_dif_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_dea_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_5': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_positive_ratio_5': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'zs_macd_dif_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_dea_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_10': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_positive_ratio_10': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'zs_macd_dif_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_dea_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_20': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_positive_ratio_20': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'zs_macd_dif_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_dea_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_40': {'bucket': 12, 'dim': 2, 'type': 'bucketId'}, 'zs_macd_positive_ratio_40': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'zs_macd_dif_dea': {'bucket': 13, 'dim': 2, 'type': 'bucketId'}, 'zs_width_20': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'zs_close_mb20_diff': {'bucket': 10, 'dim': 2, 'type': 'float'}, 'zs_cr_3d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_cr_5d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_cr_10d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_cr_20d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_cr_40d': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_rsi_3d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'zs_rsi_5d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'zs_rsi_10d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'zs_rsi_20d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'zs_rsi_40d': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'zs_turn_3d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_3dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_3davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_3dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_3dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_3d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_5dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_5davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_5dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_5dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_5d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_3_5d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_10dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_10davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_10dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_10dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_10d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_5_10d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_20dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_20davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_20dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_20dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_20d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_10_20d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_30dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_30davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_30dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_30dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_30d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_20_30d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_60dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_60davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_60dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_60dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_60d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_30_60d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_120dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_120davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_120dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_120dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_120d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_60_120d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_240dmax_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_turn_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_240davg_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_240dmax_dif': {'bucket': 110, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_240dmin_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_240d_dif': {'bucket': 510, 'dim': 5, 'type': 'float2bucket'}, 'zs_close_120_240d_avg': {'bucket': 210, 'dim': 5, 'type': 'float2bucket'}, 'label_7': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_7_real': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_7_weight': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_7_max': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_7_max_real': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_7_max_weight': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_15': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_15_real': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_15_weight': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_15_max': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_15_max_real': {'bucket': 10, 'dim': 5, 'type': 'float'}, 'label_15_max_weight': {'bucket': 10, 'dim': 5, 'type': 'float'}}

        self.get_fea_columns()
        self.dnn_dims = self.init_variable()
        self.fea_count = sum(self.select_col) - self.label_cnt

    def init_variable(self):
        dnn_hidden_1 = 1500
        dnn_hidden_2 = 1024
        dnn_hidden_3 = 700
        dnn_hidden_4 = 512
        dnn_hidden_5 = 256
        dnn_hidden_6 = 128
        dnn_hidden_7 = 64

        dnn_dims = [dnn_hidden_1, dnn_hidden_2, dnn_hidden_3, dnn_hidden_4, dnn_hidden_5, dnn_hidden_6, dnn_hidden_7]
        # dnn_dims = [dnn_hidden_1, dnn_hidden_2, dnn_hidden_3, dnn_hidden_4]
        return dnn_dims

    def decode_csv(self, line):
        data = tf.decode_csv(line, record_defaults=self.record_defaults, field_delim=',', use_quote_delim=True, na_value='', name=None)
        label = data[-self.label_cnt:]
        features = {}
        for index in range(len(self.col_name) - self.label_cnt):
            if self.select_col[index] == 1:
                fea_name = self.col_name[index]
                config = self.fea_config[fea_name]
                fea_type = config['type']
                if fea_type in ('mydefault'):
                    val = tf.cast(data[index], dtype=tf.string)
                elif fea_type in ('bucketId', 'float2bucket'):
                    val = tf.cast(data[index], dtype=tf.int32)
                elif fea_type in ('float'):
                    val = tf.cast(data[index], dtype=tf.float32)
                key = self.col_name[index]
                features[key] = val

        features['label_7'] = label[0]
        features['label_7_real'] = label[1]
        features['label_7_weight'] = label[2]
        features['label_7_max'] = label[3]
        features['label_7_max_real'] = label[4]
        features['label_7_max_weight'] = label[5]
        features['label_15'] = label[6]
        features['label_15_real'] = label[7]
        features['label_15_weight'] = label[8]
        features['label_15_max'] = label[9]
        features['label_15_max_real'] = label[10]
        features['label_15_max_weight'] = label[11]

        features['date'] = data[0]
        features['code'] = tf.cast(data[1], dtype=tf.string)
        features['industry_name_level1'] = tf.cast(data[2], dtype=tf.string)
        features['industry_name_level2'] = tf.cast(data[3], dtype=tf.string)
        features['industry_name_level3'] = tf.cast(data[4], dtype=tf.string)
        return features, label

    def train_input_fn_from_csv(self, data_path, epoch=1, batch_size=1024):
        with tf.device('/cpu:0'):
            dataset = tf.data.TextLineDataset(data_path).skip(1)
            # dataset = dataset.repeat(epoch).shuffle(buffer_size=batch_size*10000, seed=None, reshuffle_each_iteration=True).batch(batch_size)
            dataset = dataset.repeat(epoch).batch(batch_size)
            dataset = dataset.map(self.decode_csv, num_parallel_calls=20).prefetch(batch_size*10)
            dataset = dataset.make_one_shot_iterator()
            features_batch, label_batch = dataset.get_next()
            print('=================iterator============')
        return features_batch, label_batch

    def test_input_fn_from_csv(self, data_path, epoch=1, batch_size=1024):
        with tf.device('/cpu:0'):
            dataset = tf.data.TextLineDataset(data_path).skip(1)
            dataset = dataset.batch(batch_size)
            dataset = dataset.map(self.decode_csv, num_parallel_calls=10).prefetch(1000)
            dataset = dataset.make_one_shot_iterator()
            features_batch, label_batch = dataset.get_next()
            print('=================iterator============')
        return features_batch, label_batch

    def hash_embedding(self, name, hash_bucket, dim):
        cate_feature = tf.feature_column.categorical_column_with_hash_bucket(name,
                                                                          hash_bucket,
                                                                          dtype=tf.string)
        emb_col = tf.feature_column.embedding_column(
            cate_feature,
            dimension=dim,
            combiner='mean',initializer=tf.truncated_normal_initializer(stddev=self.stddev)
        )
        return emb_col
    # def tag_embedding(self, key_name, hash_bucket, dim):
    #     id_feature = layers.sparse_column_with_hash_bucket(
    #         column_name=key_name,
    #         hash_bucket_size=hash_bucket,
    #         combiner='mean',
    #         dtype=tf.string,
    #     )
    #     emb_col = layers.embedding_column(
    #         id_feature,
    #         dimension=dim,
    #         combiner='mean',initializer=tf.truncated_normal_initializer(stddev=self.stddev)
    #     )
    #     return emb_col

    # embedding for map
    def map_embedding(self, key_name, val_name, hash_bucket, dim):
        cate_feature = tf.feature_column.categorical_column_with_hash_bucket(key_name,hash_bucket,dtype=tf.string)
        w_cate_feature = tf.feature_column.weighted_categorical_column(cate_feature,val_name,dtype=tf.float32)
        emb_col = tf.feature_column.embedding_column(w_cate_feature, dimension=dim,initializer=tf.truncated_normal_initializer(stddev=self.stddev))
        return emb_col

    # embedding for hashed category
    def index_embedding(self, key_name, hash_bucket, dim):
        id_feature = tf.feature_column.categorical_column_with_identity(key_name, num_buckets=hash_bucket, default_value=0)
        emb_col = tf.feature_column.embedding_column(id_feature, dim, initializer=tf.truncated_normal_initializer(stddev=self.stddev))
        # ind_col = feature_column.indicator_column(id_feature)
        return emb_col
    def numeric_column(self, key_name):
        numeric_feature = tf.feature_column.numeric_column(key_name, shape=(1,), default_value=0, dtype=tf.float32, normalizer_fn=None)
        return numeric_feature

    def shared_embedding(self, key_name, val_name, hash_bucket):
        cate_feature = tf.feature_column.categorical_column_with_hash_bucket(key_name,hash_bucket,dtype=tf.string)
        if val_name != "":
            w_cate_feature = tf.feature_column.weighted_categorical_column(cate_feature,val_name,dtype=tf.float32)
            return w_cate_feature
        return cate_feature

    def get_fea_columns(self):
        for field_idx in range(len(self.col_name) - self.label_cnt):
            if self.select_col[field_idx] == 1:
                fea_name = self.col_name[field_idx]
                config = self.fea_config[fea_name]
                fea_bucket = config['bucket']
                fea_type = config['type']
                dim = config['dim']
                # fea_field = config['field']

                if fea_type in ('mydefault'):
                    value = self.hash_embedding(fea_name, fea_bucket, dim)
                elif fea_type in ('bucketId', 'float2bucket'):
                    value = self.index_embedding(fea_name, fea_bucket, dim)
                elif fea_type in ('float'):
                    value = self.numeric_column(fea_name)
                self.feature_columns_dict['other_feas'].append(value)

    def model_fn_params(self):
        model_fn_params_dict = {'lr': self.lr, 'optimizer': self.optimizer, 'feature_columns': self.feature_columns_dict}
        return model_fn_params_dict

    def dnn(self, net):
        for idx, units in enumerate(self.dnn_dims):
            net = tf.layers.dense(net, units=units, activation=tf.nn.relu, name='dnn_' + str(idx))
            net = tf.layers.batch_normalization(inputs=net, name='concat_bn' + str(idx), reuse=tf.AUTO_REUSE)
        # net = tf.layers.dense(net, units=1)
        return net
    def cross_layer(self, net, cross_layers):
        cross_layer = net
        with tf.name_scope('cross'):
            for idx in range(cross_layers):
                cross_layer = tf.layers.dense(cross_layer, units=1, name='cross_layer_' + str(idx))
                cross_layer = net * cross_layer + cross_layer
        return cross_layer

    def model_fn(self, features, labels, mode, params):
        #
        other_feas = params['feature_columns']['other_feas']

        with tf.device('/cpu:0'):
            all_feas = []
            all_feas = all_feas + other_feas
            embed_input = tf.feature_column.input_layer(features, all_feas)
            # embed_input = tf.reshape(embed_input, [-1, self.embedding_dim * self.fea_count])
        with tf.device('/gpu:0'):
            dnn = self.dnn(embed_input)
            cross = self.cross_layer(embed_input, 6)
            dcn = tf.concat([dnn, cross], axis=1)
            y_ctr = tf.layers.dense(dcn, units=1)
        # logging.warning('y_ctr.device: {}'.format(y_ctr.device))
        #
        # if mode == tf.estimator.ModeKeys.TRAIN and self.checkpoint_path != self.output_dir:
        #     self.init_variables_from_checkpoint()
        ctr_pred = tf.sigmoid(y_ctr, name="prediction")
        ctr_pred = tf.reshape(ctr_pred, [-1])
        # ctr_pred = tf.reshape(y_ctr, [-1])
        # predict
        # label_1d, label_3d, label_5d, label_7d
        if mode == tf.estimator.ModeKeys.PREDICT:
            predictions = {
                'predition': ctr_pred,
                'label_7': features['label_7'],
                'label_7_real': features['label_7_real'],
                'label_7_weight': features['label_7_weight'],
                'label_7_max': features['label_7_max'],
                'label_7_max_real': features['label_7_max_real'],
                'label_7_max_weight': features['label_7_max_weight'],
                'label_15': features['label_15'],
                'label_15_real': features['label_15_real'],
                'label_15_weight': features['label_15_weight'],
                'label_15_max': features['label_15_max'],
                'label_15_max_real': features['label_15_max_real'],
                'label_15_max_weight': features['label_15_max_weight'],
                'code': features['code'],
                'date': features['date'],
                'industry_name_level1': features['industry_name_level1'],
                'industry_name_level2': features['industry_name_level2'],
                'industry_name_level3': features['industry_name_level3']
            }
            return tf.estimator.EstimatorSpec(mode, predictions=predictions)
        # label_7
        ground_truth_ctr = tf.reshape(labels[0, :], [-1])
        ground_truth_ctr_weight = tf.reshape(labels[2, :], [-1])

        # # label_15
        # ground_truth_ctr = tf.reshape(labels[6, :], [-1])
        # ground_truth_ctr_weight = tf.reshape(labels[8, :], [-1])

        loss = tf.reduce_mean(tf.losses.log_loss(labels=ground_truth_ctr, predictions=ctr_pred, weights=ground_truth_ctr_weight))

        # eval
        auc_ctr = tf.metrics.auc(labels=ground_truth_ctr, predictions=ctr_pred, name='auc_ctr_op')
        metrics = {'auc_ctr': auc_ctr}
        tf.summary.scalar('auc_ctr', auc_ctr[1])

        if mode == tf.estimator.ModeKeys.EVAL:
            return tf.estimator.EstimatorSpec(mode, loss=loss, eval_metric_ops=metrics)

        # train
        if params['optimizer'] == 'Adam':
            optimizer = tf.train.AdamOptimizer(learning_rate=params['lr'], beta1=0.9, beta2=0.999, epsilon=1e-8)
        elif params['optimizer'] == 'Adagrad':
            optimizer = tf.train.AdagradOptimizer(learning_rate=params['lr'], initial_accumulator_value=1e-8)
        elif params['optimizer'] == 'Momentum':
            optimizer = tf.train.MomentumOptimizer(learning_rate=params['lr'], momentum=0.95)
        elif params['optimizer'] == 'ftrl':
            optimizer = tf.train.FtrlOptimizer(params['lr'])
        else:
            optimizer = tf.train.GradientDescentOptimizer(params['lr'])

        train_op = optimizer.minimize(loss, global_step=tf.train.get_global_step())

        return tf.estimator.EstimatorSpec(mode, loss=loss, train_op=train_op, eval_metric_ops=metrics)

    def run(self):
        tf.logging.set_verbosity(tf.logging.INFO)
        session_config = tf.ConfigProto(
                                        # device_count={'GPU': 0},
                                        # log_device_placement=True,
                                        inter_op_parallelism_threads=0,
                                        intra_op_parallelism_threads=0,
                                        allow_soft_placement=True)
        session_config.gpu_options.per_process_gpu_memory_fraction = 0.8
        session_config.allow_soft_placement = True
        session_config.gpu_options.allow_growth = True

        classifier = tf.estimator.Estimator(
            model_fn=self.model_fn,
            params=self.model_fn_params(),
            config=tf.estimator.RunConfig(
                session_config=session_config,
                model_dir=self.checkpoint_path,
                tf_random_seed=2020,
                save_summary_steps=self.save_summary_steps,
                save_checkpoints_steps=self.save_checkpoint_and_eval_step,
                keep_checkpoint_max=10)
        )

        if self.task_type == 'train':
            print("......................Start training......................")
            hooks = []
            train_spec = tf.estimator.TrainSpec(
                input_fn=lambda: self.train_input_fn_from_csv(data_path=self.train_data, epoch=self.train_epoch, batch_size=self.batch_size),
                max_steps=self.max_train_step)
            eval_spec = tf.estimator.EvalSpec(
                input_fn=lambda: self.train_input_fn_from_csv(data_path=self.test_data, epoch=1, batch_size=20000),throttle_secs=300)

            tf.estimator.train_and_evaluate(classifier, train_spec, eval_spec)

            # if self.is_chief:
            #     print("......................Start savemodel......................")
            #     classifier.export_savedmodel(self.output_dir, self.serving_input_receiver_fn, strip_default_attrs=True)
        elif self.task_type == 'predict':
            print("......................Start predict......................")
            predictions = classifier.predict(
                input_fn=lambda: self.test_input_fn_from_csv(data_path=self.test_data, epoch=1,
                                                              batch_size=self.batch_size),
                predict_keys=None,
                checkpoint_path=None,
                yield_single_examples=False
            )
            try:
                while (True):
                    predict_result = next(predictions)
                    result = pd.DataFrame({'date': list(predict_result['date']),
                                           'code': list(predict_result['code']),
                                           'industry_name_level1': list(predict_result['industry_name_level1']),
                                           'industry_name_level2': list(predict_result['industry_name_level2']),
                                           'industry_name_level3': list(predict_result['industry_name_level3']),
                                           'predition': list(predict_result['predition']),
                                           'label_7': list(predict_result['label_7']),
                                           'label_7_real': list(predict_result['label_7_real']),
                                           'label_7_weight': list(predict_result['label_7_weight']),
                                           'label_7_max': list(predict_result['label_7_max']),
                                           'label_7_max_real': list(predict_result['label_7_max_real']),
                                           'label_7_max_weight': list(predict_result['label_7_max_weight']),
                                           'label_15': list(predict_result['label_15']),
                                           'label_15_real': list(predict_result['label_15_real']),
                                           'label_15_weight': list(predict_result['label_15_weight']),
                                           'label_15_max': list(predict_result['label_15_max']),
                                           'label_15_max_real': list(predict_result['label_15_max_real']),
                                           'label_15_max_weight': list(predict_result['label_15_max_weight'])
                                           })
                    result.to_csv(self.prediction_result, mode='a',header=False, index=False, encoding='utf-8')
                    # predict_result = predict_result['predition_ctr']
                    # predict_result = predict_result['y_ctr']
                    # predict_result = predict_result['ground_truth_ctr1']
                    # predict_result = predict_result['loss']
                    # print("==================")
                    # print(predict_result['predition_ctr'])
                    # print(predict_result['label'])
                    # # print(predict_result['code'])
                    # print("==================")
            except StopIteration:
                print(
                    "predict finish..., idx: {0}, time consume: {1}".format(1, 1))

        # elif self.task_type == 'savemodel':
        #     if self.is_chief:
        #         print("......................Start savemodel......................")
        #         classifier.export_savedmodel(self.output_dir, self.serving_input_receiver_fn, strip_default_attrs=True)


#
def main():
    model = DeepFM(2010, 'predict', 'model_v6')
    test_data = 'E:/pythonProject/future/data/datafile/sample/{model_name}/train_sample_{year}_test.csv'.format(model_name='model_v5', year=str(2010))
    features_batch, label_batch = model.test_input_fn_from_csv(data_path=test_data, epoch=1, batch_size=1)

    # dataset = model.test_input_fn_from_csv(data_path=test_data, epoch=1, batch_size=2)

    with tf.Session() as sess:
        coord = tf.train.Coordinator()
        threads = tf.train.start_queue_runners(sess, coord=coord)
        # print(sess.run([data]))
        # print(sess.run([label_batch]))
        # print(sess.run([features_batch, label_batch]))
        # print(sess.run(dataset))
        while True:
            features_batch, label_batch = sess.run([features_batch, label_batch])
            print(features_batch)
            # dataset = sess.run([dataset])
            # print(dataset)
        # print(sess.run([features_batch, label_batch]))
        # print(sess.run([features_batch, label_batch]))
        # print(sess.run([features_batch, label_batch]))
        # print(sess.run([features_batch, label_batch]))
        # print(sess.run([features_batch, label_batch]))

        # coord.request_stop()
        # coord.join(threads)
        print('start')
        print('end')

if __name__ == "__main__":
    year = 2022
    date = 20221115
    model_name = 'model_v6'
    saved_model_name = 'saved_model_v6'

    model = DeepFM(year, date, 'predict', model_name, saved_model_name)
    if os.path.isfile(model.prediction_result):
        os.remove(model.prediction_result)
    model.run()